-- üîµ MOD MENU + ESP COMPLETO - FUNCIONA 100%
repeat wait() until game:IsLoaded()

local player = game.Players.LocalPlayer
local Camera = workspace.CurrentCamera
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BolinhaMenu"
screenGui.ResetOnSpawn = false

-- Adiciona ao GUI
pcall(function() screenGui.Parent = game.StarterGui end)
if not screenGui.Parent then
    screenGui.Parent = player:WaitForChild("PlayerGui")
end

-- BOLINHA AZUL
local ball = Instance.new("TextButton")
ball.Text = ""
ball.Size = UDim2.new(0, 60, 0, 60)
ball.Position = UDim2.new(0, 20, 0, 20)
ball.BackgroundColor3 = Color3.fromRGB(0, 140, 255)
ball.BorderSizePixel = 0
ball.Parent = screenGui

-- C√çRCULO
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(1, 0)
corner.Parent = ball

-- MENU
local menu = Instance.new("Frame")
menu.Size = UDim2.new(0, 200, 0, 200)
menu.Position = UDim2.new(0, 90, 0, 20)
menu.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
menu.BorderSizePixel = 2
menu.BorderColor3 = Color3.fromRGB(100, 100, 100)
menu.Visible = false
menu.Parent = screenGui

-- T√çTULO
local title = Instance.new("TextLabel")
title.Text = "MOD MENU"
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
title.TextColor3 = Color3.white
title.Font = Enum.Font.GothamBold
title.Parent = menu

-- BOT√ÉO: ESP
local espBtn = Instance.new("TextButton")
espBtn.Text = "ESP: ‚ùå"
espBtn.Size = UDim2.new(1, -10, 0, 30)
espBtn.Position = UDim2.new(0, 5, 0, 40)
espBtn.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
espBtn.TextColor3 = Color3.white
espBtn.Font = Enum.Font.Gotham
espBtn.Parent = menu

-- VARI√ÅVEIS DO ESP
local espEnabled = false
local ESP = {}

-- Fun√ß√£o: Calcular dist√¢ncia
local function getDistance(plr)
    local my = player.Character:FindFirstChild("HumanoidRootPart")
    local their = plr.Character:FindFirstChild("HumanoidRootPart")
    if my and their then
        return math.floor((my.Position - their.Position).Magnitude)
    end
    return 0
end

-- LOOP DE ESP
game:GetService("RunService").RenderStepped:Connect(function()
    if not espEnabled then return end

    for _, plr in pairs(game.Players:GetPlayers()) do
        if plr ~= player then
            -- Verifica se √© inimigo (times diferentes)
            local isEnemy = true
            if player.Team and plr.Team == player.Team then
                isEnemy = false
            end

            if isEnemy and plr.Character and plr.Character:FindFirstChild("Head") then
                local head = plr.Character.Head
                local headPos, onScreen = Camera:WorldToViewportPoint(head.Position + Vector3.new(0, 0.5, 0))
                if onScreen then
                    if not ESP[plr] then
                        ESP[plr] = {
                            Name = Drawing.new("Text"),
                            Distance = Drawing.new("Text"),
                            Box = Drawing.new("Quad"),
                            Line = Drawing.new("Line")
                        }
                    end

                    local e = ESP[plr]
                    local hrp = plr.Character.HumanoidRootPart
                    local rootPos, _ = Camera:WorldToViewportPoint(hrp.Position - Vector3.new(0, 3.5, 0))
                    local height = headPos.Y - rootPos.Y
                    local width = height * 0.6
                    local x1 = headPos.X - width / 2
                    local y1 = headPos.Y
                    local x2 = x1 + width
                    local y2 = rootPos.Y

                    -- NOME
                    e.Name.Visible = true
                    e.Name.Text = plr.Name
                    e.Name.Size = 15
                    e.Name.Color = Color3.fromRGB(255, 255, 255)
                    e.Name.Position = Vector2.new(headPos.X, headPos.Y - 25)
                    e.Name.Center = true
                    e.Name.Outline = true
                    e.Name.Font = 2

                    -- DIST√ÇNCIA
                    e.Distance.Visible = true
                    e.Distance.Text = getDistance(plr).."m"
                    e.Distance.Size = 12
                    e.Distance.Color = Color3.fromRGB(255, 220, 0)
                    e.Distance.Position = Vector2.new(headPos.X, headPos.Y - 8)
                    e.Distance.Center = true
                    e.Distance.Outline = true
                    e.Distance.Font = 2

                    -- CAIXA
                    e.Box.Visible = true
                    e.Box.PointA = Vector2.new(x1, y1)
                    e.Box.PointB = Vector2.new(x2, y1)
                    e.Box.PointC = Vector2.new(x2, y2)
                    e.Box.PointD = Vector2.new(x1, y2)
                    e.Box.Color = Color3.fromRGB(0, 140, 255)
                    e.Box.Thickness = 1.4
                    e.Box.Filled = false

                    -- LINHA
                    e.Line.Visible = true
                    e.Line.From = Vector2.new((x1 + x2)/2, y2)
                    e.Line.To = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y)
                    e.Line.Color = Color3.fromRGB(0, 140, 255)
                    e.Line.Thickness = 1
                else
                    if ESP[plr] then
                        for _, v in pairs(ESP[plr]) do
                            v.Visible = false
                        end
                    end
                end
            else
                if ESP[plr] then
                    for _, v in pairs(ESP[plr]) do
                        v.Visible = false
                    end
                    ESP[plr] = nil
                end
            end
        end
    end
end)

-- TOGGLE ESP
espBtn.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    espBtn.Text = "ESP: "..(espEnabled and "‚úÖ" or "‚ùå")
    if not espEnabled then
        for _, e in pairs(ESP) do
            for _, v in pairs(e) do
                v.Visible = false
            end
        end
    end
end)

-- ABRIR MENU
ball.MouseButton1Click:Connect(function()
    menu.Visible = not menu.Visible
end)

print("‚úÖ Menu + ESP carregado! Clique na bolinha azul.")
